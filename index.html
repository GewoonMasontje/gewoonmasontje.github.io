<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Gameblox 2014</title>

<style>
body{
    margin:0;
    font-family:Tahoma, Arial;
    background:#e3e3e3;
}
header{
    background:#2c5aa0;
    color:white;
    padding:10px;
    display:flex;
    justify-content:space-between;
    align-items:center;
}
header b{font-size:20px;}

nav{
    background:#dcdcdc;
    padding:6px;
}
nav button{
    margin:2px;
    padding:6px 10px;
    cursor:pointer;
}

.container{ padding:15px; }

.page{
    background:white;
    border:1px solid #aaa;
    padding:10px;
    margin-bottom:15px;
    display:none;
}

input{ padding:6px; width:100%; margin-bottom:6px; }

.games-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
    gap:10px;
}

.game{
    border:1px solid #aaa;
    background:#fafafa;
    padding:6px;
    text-align:center;
}

.admin-table{
    width:100%;
    border-collapse:collapse;
    display:block;
    max-height:300px;
    overflow-y:auto;
}
.admin-table thead, .admin-table tbody tr{
    display:table;
    width:100%;
    table-layout:fixed;
}
.admin-table th,.admin-table td{
    border:1px solid #aaa;
    padding:5px;
    font-size:12px;
}

.popup{
    position:fixed;
    bottom:10px;
    right:10px;
    background:#333;
    color:white;
    padding:10px;
    display:none;
}
</style>
</head>

<body>

<header>
    <b>Gameblox</b>
    <div id="topInfo"></div>
</header>

<nav id="nav" style="display:none">
    <button onclick="openPage('home')">Home</button>
    <button onclick="openPage('games')">Games</button>
    <button onclick="openPage('catalog')">Catalog</button>
    <button onclick="openPage('avatar')">Avatar</button>
    <button onclick="openPage('friends')">Friends</button>
    <button onclick="openPage('help')">Help</button>
    <button onclick="openPage('rules')">Rules</button>
    <button id="adminBtn" onclick="openPage('admin')" style="display:none">Admin</button>
    <button onclick="logout()">Logout</button>
</nav>

<div class="container">

<!-- LOGIN -->
<div id="loginPage" class="page" style="display:block">
    <h3>Login or Create Account</h3>
    <input id="usernameInput" placeholder="Username">
    <button onclick="login()">Login / Create</button>
</div>

<div id="home" class="page"></div>
<div id="games" class="page"></div>
<div id="catalog" class="page"></div>
<div id="avatar" class="page"></div>
<div id="friends" class="page"></div>
<div id="help" class="page"></div>
<div id="rules" class="page"></div>
<div id="admin" class="page"></div>

</div>

<div id="popup" class="popup"></div>

<script>
let users = JSON.parse(localStorage.getItem("gameblox_users") || "{}");
let currentUser = localStorage.getItem("gameblox_current");

if(!users["Mason.CEO"]){
    users["Mason.CEO"] = {
        money:9999,
        items:[],
        friends:[],
        admin:true,
        banned:false
    };
}

function save(){
    localStorage.setItem("gameblox_users",JSON.stringify(users));
}

function notify(msg){
    let p=document.getElementById("popup");
    p.innerText=msg;
    p.style.display="block";
    setTimeout(()=>p.style.display="none",3000);
}

function login(){
    let name=document.getElementById("usernameInput").value.trim();
    if(name.length<3){ alert("Username too short"); return; }

    if(!users[name]){
        users[name]={money:100,items:[],friends:[],admin:false,banned:false};
        notify("Account created");
    }

    if(users[name].banned){
        alert("This account is banned");
        return;
    }

    currentUser=name;
    localStorage.setItem("gameblox_current",name);
    save();
    start();
}

function logout(){
    localStorage.removeItem("gameblox_current");
    location.reload();
}

function start(){
    document.getElementById("loginPage").style.display="none";
    document.getElementById("nav").style.display="block";

    document.getElementById("topInfo").innerText =
        currentUser+" | Bloxbux: "+users[currentUser].money;

    document.getElementById("adminBtn").style.display =
        users[currentUser].admin ? "inline-block" : "none";

    openPage("home");
}

function openPage(id){
    document.querySelectorAll(".page").forEach(p=>p.style.display="none");
    document.getElementById(id).style.display="block";

    if(id==="home"){
        home.innerHTML="<h3>Welcome, "+currentUser+"</h3><button onclick='buyBloxbux()'>Buy Bloxbux (FREE)</button>";
    }
    if(id==="games"){
        games.innerHTML="<h3>Games</h3><div class='games-grid' id='gg'></div>";
        for(let i=1;i<=120;i++){
            gg.innerHTML+=`
            <div class="game">
                <b>Game ${i}</b><br>
                <button>Play</button>
                <button>Vote</button>
            </div>`;
        }
    }
    if(id==="catalog"){
        catalog.innerHTML="<h3>Catalog</h3><button onclick=\"buyItem('Cool Hat',50)\">Cool Hat (50)</button>";
    }
    if(id==="avatar"){
        avatar.innerHTML="<h3>Avatar</h3><ul>"+users[currentUser].items.map(i=>"<li>"+i+"</li>").join("")+"</ul>";
    }
    if(id==="friends"){
        friends.innerHTML="<h3>Friends</h3><input id='f'><button onclick='addFriend()'>Add</button><ul>"+users[currentUser].friends.map(f=>"<li>"+f+"</li>").join("")+"</ul>";
    }
    if(id==="help"){ help.innerHTML="<h3>Help</h3><p>Gameblox help page.</p>"; }
    if(id==="rules"){ rules.innerHTML="<h3>Rules</h3><ul><li>No exploiting</li><li>Respect admins</li></ul>"; }
    if(id==="admin"){ loadAdmin(); }
}

function buyBloxbux(){
    users[currentUser].money+=500;
    save(); start();
}

function buyItem(n,p){
    if(users[currentUser].money<p){notify("Not enough Bloxbux");return;}
    users[currentUser].money-=p;
    users[currentUser].items.push(n);
    save(); notify("Bought "+n);
}

function addFriend(){
    let f=document.getElementById("f").value.trim();
    if(users[f] && !users[currentUser].friends.includes(f)){
        users[currentUser].friends.push(f);
        save(); openPage("friends");
    }
}

function loadAdmin(){
    let html=`<h3>Admin Panel</h3>
    <button onclick="resetOwn()">Reset Own Account</button>
    <table class="admin-table"><thead>
    <tr><th>User</th><th>Money</th><th>Banned</th><th>Admin</th><th>Actions</th></tr>
    </thead><tbody>`;

    for(let u in users){
        html+=`<tr>
        <td>${u}</td>
        <td>${users[u].money}</td>
        <td>${users[u].banned}</td>
        <td>${users[u].admin}</td>
        <td>
            <button onclick="ban('${u}')">Ban</button>
            <button onclick="unban('${u}')">Unban</button>
            <button onclick="makeAdmin('${u}')">Make Admin</button>
            <button onclick="delUser('${u}')">Delete</button>
        </td></tr>`;
    }
    admin.innerHTML=html+"</tbody></table>";
}

function ban(u){ users[u].banned=true; save(); loadAdmin(); notify(u+" banned"); }
function unban(u){ users[u].banned=false; save(); loadAdmin(); }
function makeAdmin(u){ users[u].admin=true; save(); loadAdmin(); }
function delUser(u){ if(confirm("Delete "+u+"?")){ delete users[u]; save(); loadAdmin(); }}

function resetOwn(){
    users[currentUser]={money:100,items:[],friends:[],admin:users[currentUser].admin,banned:false};
    save(); notify("Account reset");
}

if(currentUser && users[currentUser] && !users[currentUser].banned){
    start();
}
</script>

</body>
</html>
